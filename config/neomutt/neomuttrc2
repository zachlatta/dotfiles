# adapted from https://gist.github.com/VladimirPal/9068b922c70a6b5e604c8d2eb099ddb7
# and https://www.rosipov.com/blog/elegant-mutt-setup-for-use-with-gmail/

bind editor <space> noop

set imap_user = zach@zachlatta.com
set imap_pass = `op get item mutt-passwd | jq '.details.fields|last.value'`

set folder    = imaps://imap.gmail.com/
set spoolfile = +INBOX
set record    = "+[Gmail]/Sent Mail"
set postponed="+[Gmail]/Drafts"

# https://www.neomutt.org/guide/reference search sleep_time for additional info
set sleep_time=0 # be faster
set beep=no # no beep sound
set editor="$EDITOR +/^$ ++1"
auto_view text/html

set sort = threads 
# When sorting by threads, this variable controls how threads are sorted
# in relation to other threads, and how the branches of the thread trees are sorted.
#set sort_aux = reverse-last-date-received
set sort_aux=last-date-received

# Index page format. Default "%4C %Z %{%b %d} %-15.15L (%?l?%4l&%4c?) %s"
set index_format="%4C %Z %{%b %d %R} %-15.15L (%?l?%4l&%4c?) %s"

set mail_check_stats

# Gmail-style keyboard shortcuts
bind index g noop
macro index ga "<change-folder>=[Gmail]/All Mail<enter>" "Go to all mail"
macro index gd "<change-folder>=[Gmail]/Drafts<enter>" "Go to drafts"
macro index gi "<change-folder>=INBOX<enter>" "Go to inbox"
macro index gs "<change-folder>=[Gmail]/Starred<enter>" "Go to starred messages"
macro index gt "<change-folder>=[Gmail]/Trash<enter>" "Go to trash"
macro index,pager d "<save-message>=[Gmail]/Trash<enter><enter>" "Trash"
macro index,pager y "<save-message>=[Gmail]/All Mail<enter><enter>" "Archive"

# Save known names of people
set alias_file        = '~/.mutt/aliases.txt'
set display_filter    = '$HOME/.mutt/aliases.sh'

source $alias_file

set realname="Zach Latta"
set from="zach@zachlatta.com"

set smtp_url = "smtps://zach@zachlatta.com@smtp.gmail.com:465/"
set smtp_pass = `op get item mutt-passwd | jq '.details.fields|last.value'`
set smtp_authenticators = "gssapi:login"
